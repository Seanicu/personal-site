---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import BlogPostLayout from '../../layouts/BlogPostLayout.astro';

export const getStaticPaths = (async () => {
  const posts = await getCollection('blog', ({ data }) => {
    return data.lang === 'zh' && !data.draft;
  });

  return posts.map((post) => {
    // 优先使用 frontmatter 中的 slug，否则使用文件名
    const slug = post.data.slug || post.slug.replace(/^zh\//, '');
    return {
      params: { slug },
      props: { post },
    };
  });
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await post.render();
const { title, description, date, tags, translationKey } = post.data;
---

<BlogPostLayout 
  title={title} 
  description={description} 
  date={date} 
  tags={tags}
  lang="zh"
  translationKey={translationKey}
>
  <Content />
</BlogPostLayout>
